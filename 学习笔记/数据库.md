# 5.数据库完成性

数据库的完整性是指数据的正确性和相容性

数据库管理系统必须能够实现如下功能

1.提供定义完整性约束条件的机制

称为完整性规则，是数据库中的数据必须满足的语义约束条件。

2.提供完整性检查的方法

检查数据否满足完整性约束条件的机制叫完整性检查。

3.进行违约处理

如果违背了完整性约束条件将采取一定动作。

## 5.1实体完整性

5.1.1定义实体完整性

```
create table student{
	sno char(9) primary key;   在列级定义主码
}

 create table student{    
 	sno char(9) not null;  
    primary key (sno);   在表级定义主码
 }
 
  create table student{    
 	sno char(9) not null;  
 	cno char(4) not null;
    primary key (sno,cno);   只能在表级定义主码
 }
```



5.1.2实体完整性检查和违约处理

用primary key定义了主码后，要插入或修改一条数据时，就会自动进行检查

1检查主码值是否唯一，如果不唯一则拒绝

2检查主码的各个属性是否为空，只要有一个为空就拒绝



检主码是否唯一要进行全表扫描，但是很消耗时间，所以建立**B+树索引**

## 5.2参照完整性

5.2.1定义参完整性

foreign key  references

```
  create table sc{    
 	sno char(9) not null,  
 	cno char(4) not null,
    primary key (sno,cno), 在表级定义实体完整性
    foreign key (sno) references student(sno), 在表级定义参照完整性
    foreign key (cno) references course(cno)
 }
```

5.2.2参照完整性检查和违约处理

1 拒绝(no action)执行

不允许该操作执行。该策略一般设置为**默认策略**

2 级联(cascade)操作

删除或修改被参照表的一个元组导致与参照表的不一致时，删除或修改参照表的所有导致不一致的元组

3 设置为空值

被参照表被修改造成不一致，则将参照表中的所有造成不一致的元组的对应属性设置为空值。当然你还有考虑这个值是否能为空

```
显示说明参照完整性的违约处理示例
create table sc{
	sno char(),
	cno char(),
	primary key (sno,cno),
	foreign key (sno) references student(sno)
		on delete cascade 当删除student表中的元素是，级联删除sc表中相应的元组   
		//on delete no action 拒绝操作
		on update cascade,
}
```

## 5.3用户定义的完整性

5.3.1属性上的约束条件

1 属性上的约束条件定义

not null，unique，check短语定义列值应该满足的条件

```
create table student{
	sno,
	sname, 
	ssex char(2) check(ssex in('男','女'))
}
```

2 属性上约束条件的检查和违约处理

不满足则拒绝操作



5.3.2元组上的约束条件

1 定义元组上约束条件的定义

同属性值限制相比，元组级的限制可以设置不同属性之间的取值的相互约束条件

```
create table student{
	sno,
	sname, 
	ssex char(2),
	check (ssex='女' or sname not like 'ms.%') 当学生性别是男的时，名字不能以ms.开头
 }
```



如果不满足就拒绝操作

## 5.4完整性约束命名句子

1 完整性约束命名子句

constraint

```
create table student{
	sno numeric(6)
		constraint c1 check (sno between 9000 and 99999) 要求学号在这个区间
}
```

2 修改表中的完整性限制

```
alter table student
	drop constraint c1
alter table student 
	add constraint c2 check (sno between 90 and 90)
```



## 5.6断言

